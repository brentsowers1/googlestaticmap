<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class GoogleStaticMap - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/googlestaticmap.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-get_map">#get_map</a>
    
    <li><a href="#method-i-relative_url">#relative_url</a>
    
    <li><a href="#method-i-url">#url</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./History_txt.html">History</a>
  
    <li class="file"><a href="./README.html">README</a>
  
    <li class="file"><a href="./Rakefile.html">Rakefile</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./GoogleStaticMapHelperTest.html">GoogleStaticMapHelperTest</a>
  
    <li><a href="./GoogleStaticMap.html">GoogleStaticMap</a>
  
    <li><a href="./MapLocation.html">MapLocation</a>
  
    <li><a href="./MapMarker.html">MapMarker</a>
  
    <li><a href="./MapPath.html">MapPath</a>
  
    <li><a href="./MapPolygon.html">MapPolygon</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class GoogleStaticMap</h1>

  <div id="description" class="description">
    
<p>Main class for creating a static map.  Create an instance, Set attributes
that describe properties of the map.  Then call url to get a URL that you
can use as the src of an img tag.  You can also call <a
href="GoogleStaticMap.html#method-i-get_map">#get_map</a> to actually
download the map from Google, and optionally write it to a file.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-center" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">center</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p><a href="MapLocation.html">MapLocation</a> for the center of the map. If
this is not specified, the map will zoom to the markers</p>
        
        </div>
      </div>
      
      <div id="attribute-i-format" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">format</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>format of the image:</p>
<ul><li>
<p>png8 - 8 bit PNG (default)</p>
</li><li>
<p>png32 - 32 bit PNG</p>
</li><li>
<p>gif</p>
</li><li>
<p>jpg</p>
</li><li>
<p>jpg-baseline - non-progressive JPEG</p>
</li></ul>
        
        </div>
      </div>
      
      <div id="attribute-i-height" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">height</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Height of resulting image in pixels, defaults to 350, maximum 640</p>
        
        </div>
      </div>
      
      <div id="attribute-i-maptype" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">maptype</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Type of map to create:</p>
<ul><li>
<p>roadmap (default)</p>
</li><li>
<p>satellite</p>
</li><li>
<p>terrain</p>
</li><li>
<p>hybrid - satellite imagery with roads</p>
</li></ul>
        
        </div>
      </div>
      
      <div id="attribute-i-markers" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">markers</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>An optional array of <a href="MapMarker.html">MapMarker</a> instances</p>
        
        </div>
      </div>
      
      <div id="attribute-i-paths" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">paths</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>An optional array of <a href="MapPath.html">MapPath</a> instances and/or <a
href="MapPolygon.html">MapPolygon</a> instances to draw</p>
        
        </div>
      </div>
      
      <div id="attribute-i-proxy_address" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">proxy_address</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>If you need to use a proxy server to reach Google, set the name/address of
the proxy server here</p>
        
        </div>
      </div>
      
      <div id="attribute-i-proxy_port" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">proxy_port</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>If <a
href="GoogleStaticMap.html#attribute-i-proxy_address">#proxy_address</a> is
set, set this to the port of the proxy server</p>
        
        </div>
      </div>
      
      <div id="attribute-i-scale" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">scale</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>1, 2, or 4 for Maps API Premier customers. Defaults to 1. Makes everything
in the image appear larger, useful for displaying on high res mobile
screens.  When setting this, the image’s actual width and height in pixels
will be scale * width and scale * height</p>
        
        </div>
      </div>
      
      <div id="attribute-i-sensor" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">sensor</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Applications that determine the user’s location via a sensor must set this
to true, defaults to false</p>
        
        </div>
      </div>
      
      <div id="attribute-i-width" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">width</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Width of resulting image in pixels, defaults to 500, maximum 640</p>
        
        </div>
      </div>
      
      <div id="attribute-i-zoom" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">zoom</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>0 (the whole world) to 21 (individual buildings)</p>
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(attrs={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Takes an optional hash of attributes</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/googlestaticmap.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">attrs</span>={})
  <span class="ruby-identifier">defaults</span> = {<span class="ruby-value">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">500</span>, <span class="ruby-value">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">350</span>, <span class="ruby-value">:markers</span> =<span class="ruby-operator">&gt;</span> [],
              <span class="ruby-value">:sensor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:maptype</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;roadmap&quot;</span>, <span class="ruby-value">:paths</span> =<span class="ruby-operator">&gt;</span> [],
              <span class="ruby-value">:proxy_port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:proxy_address</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,}
              
  <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">defaults</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">attrs</span>)
  <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{k}=&quot;</span>.<span class="ruby-identifier">to_sym</span>,<span class="ruby-identifier">v</span>)}
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-get_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_map</span><span
            class="method-args">(output_file=nil, protocol='http')</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Connects to Google, retrieves the map, and returns the bytes for the image.
Optionally, pass it an output name and the contents will get written to
this file name <code>output_file</code> - optionally give the name of a
file to write the output to.</p>

<pre>Pass nil to not write the output to a file</pre>

<p><code>protocol</code> - specify http or https here for the protocol to
retrieve the</p>

<pre>map with. Defaults to http</pre>

<p>return value - the binary data for the map</p>
          

          
          <div class="method-source-code" id="get_map-source">
            <pre><span class="ruby-comment"># File lib/googlestaticmap.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_map</span>(<span class="ruby-identifier">output_file</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">protocol</span>=<span class="ruby-string">'http'</span>)
  <span class="ruby-identifier">protocol</span> = <span class="ruby-string">'http'</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">protocol</span> <span class="ruby-operator">==</span> <span class="ruby-string">'http'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">protocol</span> = <span class="ruby-string">'https'</span>
  <span class="ruby-identifier">http</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-constant">Proxy</span>(<span class="ruby-ivar">@proxy_address</span>,<span class="ruby-ivar">@proxy_port</span>).<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;maps.google.com&quot;</span>, <span class="ruby-value">80</span>)
  <span class="ruby-identifier">resp</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">http</span>.<span class="ruby-identifier">get2</span>(<span class="ruby-identifier">relative_url</span>(<span class="ruby-identifier">protocol</span>))
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTPSuccess</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">output_file</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">output_file</span>, <span class="ruby-string">&quot;wb&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span> }
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">data</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Exception</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Error encountered while retrieving google map, code #{resp.code}, text #{resp.body}&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Exception</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Error while retrieve google map, no response&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_map-source -->
          
        </div>

        

        
      </div><!-- get_map-method -->

    
      <div id="method-i-relative_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">relative_url</span><span
            class="method-args">(protocol='http')</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns the URL to retrieve the map, relative to <a
href="http://maps.google.com">maps.google.com</a> Example -
“/maps/api/staticmap?params…”</p>
          

          
          <div class="method-source-code" id="relative_url-source">
            <pre><span class="ruby-comment"># File lib/googlestaticmap.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">relative_url</span>(<span class="ruby-identifier">protocol</span>=<span class="ruby-string">'http'</span>)
  <span class="ruby-identifier">url</span>(<span class="ruby-identifier">protocol</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r[^\/]*\/\/maps\.google\.com/</span>, <span class="ruby-string">&quot;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- relative_url-source -->
          
        </div>

        

        
      </div><!-- relative_url-method -->

    
      <div id="method-i-url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">url</span><span
            class="method-args">(protocol='http')</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns the full URL to retrieve this static map.  You can use this as the
src for an img to display an image directly on a web page Example - “<a
href="http://maps.google.com/maps/api/staticmap?params...">maps.google.com/maps/api/staticmap?params…</a>”
<code>protocol</code> can be ‘http’, ‘https’ or :auto. Specifying :auto
will not return</p>

<pre>a protocol in the URL (&quot;//maps.google.com/...&quot;), allowing the browser to
select the appropriate protocol (if the page is loaded with https, it will
use https). Defaults to http</pre>
          

          
          <div class="method-source-code" id="url-source">
            <pre><span class="ruby-comment"># File lib/googlestaticmap.rb, line 135</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">url</span>(<span class="ruby-identifier">protocol</span>=<span class="ruby-string">'http'</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@center</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@markers</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@paths</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Exception</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Need to specify either a center, markers, or a path&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">protocol</span> = <span class="ruby-string">'http'</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">protocol</span> <span class="ruby-operator">==</span> <span class="ruby-string">'http'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">protocol</span> <span class="ruby-operator">==</span> <span class="ruby-string">'https'</span> <span class="ruby-operator">||</span>
                           <span class="ruby-identifier">protocol</span> <span class="ruby-operator">==</span> <span class="ruby-value">:auto</span>
  <span class="ruby-identifier">protocol</span> = <span class="ruby-identifier">protocol</span> <span class="ruby-operator">==</span> <span class="ruby-value">:auto</span> <span class="ruby-operator">?</span> <span class="ruby-string">''</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">protocol</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;:&quot;</span>
  <span class="ruby-identifier">u</span> = <span class="ruby-node">&quot;#{protocol}//maps.google.com/maps/api/staticmap?&quot;</span>
  <span class="ruby-identifier">attrs</span> = <span class="ruby-constant">GoogleStaticMapHelpers</span>.<span class="ruby-identifier">safe_instance_variables</span>(<span class="ruby-keyword">self</span>,
            [<span class="ruby-string">&quot;markers&quot;</span>, <span class="ruby-string">&quot;paths&quot;</span>, <span class="ruby-string">&quot;width&quot;</span>, <span class="ruby-string">&quot;height&quot;</span>, <span class="ruby-string">&quot;center&quot;</span>,
             <span class="ruby-string">&quot;proxy_address&quot;</span>, <span class="ruby-string">&quot;proxy_port&quot;</span>],
            <span class="ruby-value">:cgi_escape_values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-identifier">attrs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-string">&quot;size&quot;</span>, <span class="ruby-node">&quot;#{@width}x#{@height}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@width</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@height</span>
  <span class="ruby-identifier">markers</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attrs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-string">&quot;markers&quot;</span>,<span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span>] }
  <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attrs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-string">&quot;path&quot;</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">to_s</span>] }
  <span class="ruby-identifier">attrs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-string">&quot;center&quot;</span>, <span class="ruby-identifier">center</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">center</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">u</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{attr[0]}=#{attr[1]}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&amp;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- url-source -->
          
        </div>

        

        
      </div><!-- url-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

